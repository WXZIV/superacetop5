<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1"
  />
  <meta name="theme-color" content="#0b0b0f" />
  <title>Race for Riches Leaderboard</title>

  <!-- Optional fonts (lightweight) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      /* dynamic viewport height (updated by JS) */
      --vh: 100vh;

      /* colors */
      --bg:#0b0b0f;
      --panel:#131722;
      --rail:#e64646;
      --text:#e9eef5;
      --muted:#a7b1bb;
      --gold:#ffd166;

      /* sizing */
      --pad: max(12px, env(safe-area-inset-left));
    }

    *{ box-sizing:border-box; }
    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      text-rendering:optimizeLegibility;
    }

    /* Top bar (small, non-intrusive) */
    .bar{
      position:fixed;
      z-index:5;
      top: env(safe-area-inset-top);
      left: 0;
      right: 0;
      padding: 10px calc(var(--pad)) 8px calc(var(--pad));
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      background: linear-gradient(180deg, rgba(10,10,14,.85), rgba(10,10,14,.40) 70%, rgba(10,10,14,0));
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      pointer-events: none; /* keep taps for iframe; buttons re-enable pointer-events */
    }
    .brand{
      pointer-events:auto;
      display:flex; align-items:center; gap:10px;
      font-weight:700; letter-spacing:.2px;
      color:var(--gold);
      text-shadow: 0 0 10px rgba(230,70,70,.25);
      user-select:none;
    }
    .brand-bullet{
      width:10px;height:10px;border-radius:50%;
      background: radial-gradient(closest-side, var(--rail), #7a2424);
      box-shadow:0 0 12px #e64646;
    }
    .btn{
      pointer-events:auto;
      appearance:none;
      border:1px solid rgba(255,255,255,.12);
      color:#111;
      background: linear-gradient(150deg,#ffd166,#ffb347 60%,#ffe08a);
      font-weight:700;
      font-size:14px;
      padding:10px 14px;
      border-radius:10px;
      box-shadow: 0 6px 18px rgba(255,209,102,.25), inset 0 0 0 1px rgba(255,255,255,.35);
      cursor:pointer;
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .btn:active{ transform:translateY(1px); }

    /* Full-viewport frame */
    .frame{
      position:fixed;
      z-index:1;
      top:  calc(env(safe-area-inset-top));
      left: calc(env(safe-area-inset-left));
      right:calc(env(safe-area-inset-right));
      bottom:calc(env(safe-area-inset-bottom));
      width:  calc(100% - env(safe-area-inset-left) - env(safe-area-inset-right));
      height: calc(var(--vh) - env(safe-area-inset-top) - env(safe-area-inset-bottom));
      border:0;
      display:block;
      background:#000;
      /* helps mobile feel native when content inside scrolls */
      -webkit-overflow-scrolling: touch;
    }

    /* Loading overlay */
    .loader{
      position:fixed; inset:0;
      display:grid; place-items:center;
      z-index:4;
      background: radial-gradient(1200px 600px at 50% -200px, rgba(230,70,70,.10), transparent 60%), var(--bg);
      color:var(--text);
      transition: opacity .35s ease;
    }
    .loader.hidden{ opacity:0; pointer-events:none; }

    .spin{
      width:46px;height:46px;border-radius:50%;
      border:3px solid rgba(255,255,255,.18);
      border-top-color: var(--gold);
      animation: r 1s linear infinite;
      margin: 14px auto 10px;
      box-shadow: 0 0 24px rgba(255,209,102,.25);
    }
    @keyframes r{ to{ transform: rotate(360deg); } }

    .hint{
      font-size:13px; color:var(--muted); text-align:center; max-width:92%;
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .spin{ animation: none; }
      .loader, .btn{ transition: none; }
    }
  </style>
</head>
<body>

  <!-- Tiny decorative top bar + fallback open button -->
  <div class="bar" aria-hidden="true">
    <div class="brand"><span class="brand-bullet"></span>Race for Riches</div>
    <button class="btn" id="openNew">Open in new tab</button>
  </div>

  <!-- Fullscreen wrapper iframe -->
  <iframe
    id="app"
    class="frame"
    title="Race for Riches Leaderboard"
    src="https://script.google.com/macros/s/AKfycbxtgC2XQy3xepJlt4zbenH3gHq9gJeUMUeazpHiGD71OIqVg-BGIXUoxurTnoQpzWQB/exec"
    referrerpolicy="no-referrer"
    loading="eager"
    sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"
    allow="clipboard-read; clipboard-write; fullscreen">
  </iframe>

  <!-- Loading -->
  <div class="loader" id="loader" role="status" aria-live="polite">
    <div>
      <div class="spin" aria-hidden="true"></div>
      <div class="hint">Loading Leaderboard… If it takes too long, tap “Open in new tab”.</div>
    </div>
  </div>

  <script>
    // --- Robust 100vh fix using visualViewport (better on mobile toolbars) ---
    (function vhFix(){
      const set = () => {
        const vv = window.visualViewport;
        const h = vv ? vv.height : window.innerHeight;
        document.documentElement.style.setProperty('--vh', h + 'px');
      };
      set();
      window.addEventListener('resize', set, {passive:true});
      if (window.visualViewport) {
        window.visualViewport.addEventListener('resize', set, {passive:true});
      }
    }());

    // --- Loader hide when iframe loads (with timeout fallback) ---
    const app    = document.getElementById('app');
    const loader = document.getElementById('loader');
    const openNew= document.getElementById('openNew');
    const APP_URL = app.src;

    let done = false;
    const hide = () => {
      if (done) return;
      done = true;
      loader.classList.add('hidden');
    };

    app.addEventListener('load', hide);
    // Fallback: if GAS blocks framing or is slow, show the button immediately
    setTimeout(() => { if (!done) loader.classList.remove('hidden'); }, 300);      // ensure visible
    setTimeout(() => { if (!done) openNew.focus({preventScroll:true}); }, 2500);    // guide user
    // Hard timeout in case 'load' never fires
    setTimeout(() => { if (!done) hide(); }, 8000);

    // Open in new tab (always available)
    openNew.addEventListener('click', () => { window.open(APP_URL, '_blank', 'noopener'); });

    // iOS: small nudge to keep audio/video gestures within iframe responsive
    document.addEventListener('gesturestart', e => e.preventDefault(), {passive:false});
  </script>
</body>
</html>
